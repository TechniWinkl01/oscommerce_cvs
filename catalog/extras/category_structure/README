The Exchange Project Category Structure Upgrade Script
for Preview Release 1.x -> Preview Release 2.x

Version: 1.0
Last Update: 25/09/2000

What Does This Script Do?
-------------------------
This script upgrades the old category structure used in the
Preview Release 1.x releases, to the new structure thats
optimized for the new Preview Release 2.x releases.

This new structure allows for an unlimited number of
category->category (category to category) relations, and
also allows for category->products->category relations.

Whats Different?
----------------
The structure that Preview Release 1.x is based on relies
on 'Indexes'. Having Indexes allows the customer to navigate
through the categories/subcategories/products with special
attributes. Included in Preview Release 1.x, are the
'Products' and 'Manufacturers' Indexes, which give the
customer the opportunity to list, in the current category,
products sorted by the products name, or by their manufacturers
names

Indexes are no longer in use with the new category structure,
instead, all products a listed by the the products name.

Do I Have To Do Anything Manually?
----------------------------------
No, this script is automated. It will create two new tables,
'categories' and 'products_to_categories'. It
gathers related data from 'category_top', 'subcategories',
'subcategories_to_category', 'products_to_subcategories' and
inserts it into the newly created tables.

No tables or data are deleted from the database via this
script.

Can I Test This Script First?
-----------------------------
Yes! This is strongly recommended to follow.

The safest way to test this script is to make an exact
copy of your database. This can be done with mysqldump:

shell> mysqldump catalog > /tmp/catalog.sql
shell> mysqladmin create catalog_test
shell> mysql catalog_test < /tmp/catalog.sql

After performing the above commands, a new database called
'catalog_test' will be created, which is an exact copy, or
backup, of the 'catalog' database.

Edit the upgrade script's database connection parameters -
make sure its pointing to the right database! (catalog_test)

Run the upgrade script either through your command shell, or
with a HTTP request through your webserver.

either a)

shell> php ./upgrade.php

or b)

shell> lynx http://localhost/upgrade.php

(Note: Lynx is a text-based web-browser)

If the upgrade script is executed through a HTTP request
(web server), the linefeeds will not be displayed properly.
Viewing the page source in the browser will remedy this.

If no error messages are displayed, the test-database
should have two new tables. This is viewable by performing
the following commands:

shell> mysql catalog_test
mysql> show tables;

'categories' and 'products_to_categories' should
be in the list of tables.

Is That All?
------------
No! View the data in these tables. If the relations look
right, its time to test the catalog with the new category
structure. Backup your webserver pages, and copy the new
pages from the cvs repository. Edit the application_top.php
file, and change the database parameter to the test
database you created (catalog_test).

Point your browser to your catalog, and see the glory of the
new category structure :)

When all is well, repeat the steps to your normal database. Please
keep backups of your data before you do anything.

It is also recommended to remove the unused tables from your
database after verifying 100% that the new category structure
works!

mysql> drop table category_top;
mysql> drop table category_index_to_top;
mysql> drop table category_index;
mysql> drop table manufacturers_to_category;
mysql> drop table subcategories_to_category;
mysql> drop table subcategories;
mysql> drop table products_to_subcategories;

Where Can I Go To For Help?
---------------------------
Please direct any questions you may have to the general mailing
list at The Exchange Project. For mailing list access, you will
need to create an account on the support site.

Comments to the script, and to this readme, are also
welcomed!

----------------------------------------------------
Harald Ponce de Leon (hpdl@theexchangeproject.org)
The Exchange Project - http://theexchangeproject.org 